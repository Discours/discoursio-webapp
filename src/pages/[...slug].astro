---
import { Root } from '../components/Root'
import Zine from '../layouts/zine.astro'
import { apiClient } from '../utils/apiClient'
import { initRouter } from '../stores/router'

const slug = Astro.params.slug?.toString()
const routepaths = ['craete', 'search', 'inbox', 'topics', 'authors', 'robots.txt']
if (routepaths.includes(slug) || Boolean(slug) === false || slug.includes('.map')) return

const article = await apiClient.getArticle({ slug })
if (!article) {
  return Astro.redirect('/404')
}

const { pathname, search } = Astro.url
initRouter(pathname, search)

Astro.response.headers.set('Cache-Control', 's-maxage=1, stale-while-revalidate')
---

<Zine>
  <Root article={article} client:load />
</Zine>
