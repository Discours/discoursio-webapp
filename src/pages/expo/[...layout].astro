---
import { Root } from '../../components/Root'
import Prerendered from '../../main.astro'
import { apiClient } from '../../utils/apiClient'
import { initRouter } from '../../stores/router'

const layout = Astro.params.layout?.toString()
if (layout.endsWith('.map')) {
  return Astro.redirect('/404')
}
const LAYOUTS = ['literature', 'audio', 'video', 'artworks']
if (!LAYOUTS.includes(layout)) {
  return Astro.redirect('/404')
}
const shouts = await apiClient.getLayoutShouts({ layout })
const { pathname, search } = Astro.url
initRouter(pathname, search)
---

<Prerendered>
  <Root shouts={shouts} layout={layout} client:load />
</Prerendered>

